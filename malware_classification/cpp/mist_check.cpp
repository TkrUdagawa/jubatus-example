#include <string>
#include <iostream>
#include <exception>
#include "mist.hpp"

using namespace std;

int main(int argc, char *argv[])
{
  if (argc < 3) {
    cout << "./mist_check <refset.csv> <mist_dir>" << endl;
    return -1;
  }

  vector<sample_type> targets = load_csv(argv[1]);

  cout << "File: " << argv[1] << ", target size: " << targets.size() << endl;
  if (targets.size() <= 0)
    return 0;

  sample_type sample = targets[0];
  cout << "sha1: " << sample.sha1 << endl;
  cout << "label: "<< sample.label << endl;
  cout << "size: " << sample.filesize << endl;

  string path = argv[2];
  path += "/";
  path += sample.sha1;
  path += ".";
  path += sample.label;

  cout << "Sample file: " << path << endl;

  vector<pair<string, string > > mist = load_mist(path);
  vector<pair<string, string > >::iterator it = mist.begin(), end = mist.end();
  for (; it != end; ++it) {
    cout << " thread     : " << it->first << endl;
    cout << " joined mist: " << it->second << endl;
  }

  return 0;
}
